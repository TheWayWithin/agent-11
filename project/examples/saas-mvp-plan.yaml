# SaaS MVP Project Plan Example
# Demonstrates: project-plan.schema.yaml, phase-context.schema.yaml, quality-gate.schema.yaml
# Use Case: Subscription management platform for solopreneurs
# Generated by: AGENT-11 /bootstrap command

---
# ============================================================================
# META - Project identification and versioning
# ============================================================================
meta:
  name: "SubTrack MVP"
  created: "2025-01-15"
  last_updated: "2025-01-22"
  version: "0.3.0"
  status: active  # draft | active | paused | complete | archived

# ============================================================================
# VISION - High-level objectives and constraints
# ============================================================================
vision:
  objective: "Subscription management platform for solopreneurs to track recurring revenue"
  success_criteria:
    - "User can sign up with email/password"
    - "User can connect Stripe account"
    - "Dashboard shows MRR, churn, and growth metrics"
    - "User receives email notifications for subscription events"
  constraints:
    timeline: "Launch MVP by Feb 15, 2025"
    budget: "$0 infrastructure (free tier only)"
    technical:
      - "Next.js 14+ with App Router"
      - "Supabase for auth and database"
      - "Stripe for payment data"
      - "Netlify for hosting"
  # Sprint 9: BOS-AI Foundation Document Integration
  foundation_manifest:
    manifest_path: ".context/handoff-manifest.json"
    summaries_dir: ".context/summaries/"
    initialized: true
    token_budget_total: 1200  # Proportional to information density
    documents:
      prd: ".context/summaries/prd-summary.md"           # 600 tokens
      vision: ".context/summaries/vision-summary.md"     # 200 tokens
      icp: ".context/summaries/icp-summary.md"           # 200 tokens
      brand: null  # Not yet imported from BOS-AI

# ============================================================================
# PHASES - Development phases with tasks and gates
# ============================================================================
phases:
  # --------------------------------------------------------------------------
  # Phase 1: Foundation
  # --------------------------------------------------------------------------
  - id: foundation
    name: "Foundation"
    status: complete
    objectives:
      - "Set up project structure and tooling"
      - "Configure authentication"
      - "Establish CI/CD pipeline"
    tasks:
      - id: "1.1"
        description: "Initialize Next.js 14 project with TypeScript"
        status: complete
        assigned_to: "@developer"
        estimate: "30m"
        dependencies: []
        context: "Using create-next-app with --typescript --tailwind --eslint"
      - id: "1.2"
        description: "Configure Supabase client and auth"
        status: complete
        assigned_to: "@developer"
        estimate: "1h"
        dependencies: ["1.1"]
        context: "Using @supabase/ssr for Next.js 14 server components"
      - id: "1.3"
        description: "Create auth pages (login, signup, forgot-password)"
        status: complete
        assigned_to: "@developer"
        estimate: "2h"
        dependencies: ["1.2"]
      - id: "1.4"
        description: "Set up Netlify deployment"
        status: complete
        assigned_to: "@operator"
        estimate: "30m"
        dependencies: ["1.1"]
    gate:
      type: build
      blocking: true
      criteria: "npm run build && npm run lint pass"
      status: passed
    deliverables:
      - "/src/app/auth/ - Auth pages"
      - "/src/lib/supabase.ts - Client configuration"
      - "netlify.toml - Deployment config"

  # --------------------------------------------------------------------------
  # Phase 2: Core Features (CURRENT)
  # --------------------------------------------------------------------------
  - id: core-features
    name: "Core Features"
    status: in_progress
    objectives:
      - "Stripe OAuth integration"
      - "Subscription data sync"
      - "Basic dashboard metrics"
    tasks:
      - id: "2.1"
        description: "Implement Stripe OAuth Connect flow"
        status: complete
        assigned_to: "@developer"
        estimate: "3h"
        dependencies: ["phase:foundation.gate"]
        context: "Using Stripe Connect with Standard accounts for simplicity"
      - id: "2.2"
        description: "Create Stripe webhook handler for subscription events"
        status: in_progress
        assigned_to: "@developer"
        estimate: "2h"
        dependencies: ["2.1"]
        context: "Need checkout.session.completed, invoice.paid, customer.subscription.*"
      - id: "2.3"
        description: "Build subscription database schema"
        status: pending
        assigned_to: "@developer"
        estimate: "1h"
        dependencies: ["2.1"]
      - id: "2.4"
        description: "Create dashboard with MRR calculation"
        status: pending
        assigned_to: "@developer"
        estimate: "3h"
        dependencies: ["2.2", "2.3"]
      - id: "2.5"
        description: "Design dashboard UI components"
        status: pending
        assigned_to: "@designer"
        estimate: "2h"
        dependencies: ["2.4"]
    gate:
      type: test
      blocking: true
      criteria: "npm test passes with >70% coverage on core features"
      status: pending
    deliverables:
      - "/src/app/api/stripe/ - Stripe API routes"
      - "/src/app/dashboard/ - Dashboard pages"
      - "/supabase/migrations/ - Database schema"

  # --------------------------------------------------------------------------
  # Phase 3: Polish & Launch Prep
  # --------------------------------------------------------------------------
  - id: polish
    name: "Polish & Launch Prep"
    status: not_started
    objectives:
      - "Email notifications"
      - "Landing page"
      - "Documentation"
    tasks:
      - id: "3.1"
        description: "Set up Resend for transactional emails"
        status: pending
        assigned_to: "@developer"
        estimate: "1h"
        dependencies: ["phase:core-features.gate"]
      - id: "3.2"
        description: "Create landing page with pricing"
        status: pending
        assigned_to: "@designer"
        estimate: "3h"
        dependencies: ["phase:core-features.gate"]
      - id: "3.3"
        description: "Write user documentation"
        status: pending
        assigned_to: "@documenter"
        estimate: "2h"
        dependencies: ["3.2"]
      - id: "3.4"
        description: "Security audit and fixes"
        status: pending
        assigned_to: "@tester"
        estimate: "2h"
        dependencies: ["3.1", "3.2"]
    gate:
      type: security
      blocking: true
      criteria: "npm audit clean, no XSS/CSRF vulnerabilities"
      status: pending
    deliverables:
      - "/src/app/page.tsx - Landing page"
      - "/docs/ - User documentation"
      - "Security audit report"

  # --------------------------------------------------------------------------
  # Phase 4: Launch
  # --------------------------------------------------------------------------
  - id: launch
    name: "Launch"
    status: not_started
    objectives:
      - "Production deployment"
      - "Monitoring setup"
      - "Beta user onboarding"
    tasks:
      - id: "4.1"
        description: "Configure production environment variables"
        status: pending
        assigned_to: "@operator"
        estimate: "30m"
        dependencies: ["phase:polish.gate"]
      - id: "4.2"
        description: "Set up error monitoring (Sentry)"
        status: pending
        assigned_to: "@operator"
        estimate: "1h"
        dependencies: ["4.1"]
      - id: "4.3"
        description: "Create onboarding email sequence"
        status: pending
        assigned_to: "@marketer"
        estimate: "2h"
        dependencies: ["4.1"]
      - id: "4.4"
        description: "Launch and announce"
        status: pending
        assigned_to: "@coordinator"
        estimate: "1h"
        dependencies: ["4.2", "4.3"]
    gate:
      type: deploy
      blocking: true
      criteria: "Production health check passes, Stripe webhooks verified"
      status: pending
    deliverables:
      - "Production deployment live"
      - "Monitoring dashboard"
      - "Launch announcement"

# ============================================================================
# CURRENT STATE - Active execution state for coordinator
# ============================================================================
current_state:
  phase_id: "core-features"
  task_id: "2.2"
  status: executing  # executing | waiting | blocked | gate_pending
  blockers: []
  next_action: "Complete Stripe webhook handler implementation"
  last_activity: "2025-01-22T14:30:00Z"

# ============================================================================
# QUALITY GATES - Gate definitions referenced by phases
# ============================================================================
quality_gates:
  - gate_id: "build_foundation"
    ref: "templates/build"
    customizations:
      checks:
        - check_id: "typescript"
          command: "npm run type-check"
          expected:
            exit_code: 0

  - gate_id: "test_core"
    ref: "templates/test"
    customizations:
      checks:
        - check_id: "stripe_tests"
          command: "npm test -- stripe"
          expected:
            exit_code: 0
        - check_id: "coverage"
          command: "npm run test:coverage"
          expected:
            contains: "All files"
            not_contains: "under 70%"

  - gate_id: "security_polish"
    ref: "templates/security"
    customizations:
      checks:
        - check_id: "secrets_scan"
          command: "grep -r 'sk_live' src/ || true"
          expected:
            exit_code: 0
            not_contains: "sk_live"

  - gate_id: "deploy_launch"
    ref: "templates/deploy"
    customizations:
      url: "https://subtrack.app/api/health"
      retry: 5
      timeout: 120

# ============================================================================
# SPECIALIST ROUTING - Task-to-agent routing rules
# ============================================================================
specialist_routing:
  - pattern: "^(implement|create|build|code|fix|refactor)"
    agent: "@developer"
    context_requirements:
      - "architecture"
      - "current_codebase"
      - "active_phase_context"
    skills:
      - "saas-auth"
      - "saas-payments"

  - pattern: "^(design|UI|UX|layout|style)"
    agent: "@designer"
    context_requirements:
      - "brand_guidelines"
      - "design_system"
    skills:
      - "saas-onboarding"

  - pattern: "^(test|verify|validate|security|audit)"
    agent: "@tester"
    context_requirements:
      - "test_strategy"
      - "acceptance_criteria"

  - pattern: "^(deploy|configure|set up|infrastructure)"
    agent: "@operator"
    context_requirements:
      - "deployment_config"
      - "environment_secrets"

  - pattern: "^(write|document|explain)"
    agent: "@documenter"
    context_requirements:
      - "audience"
      - "documentation_style"

  - pattern: "^(launch|announce|email|marketing)"
    agent: "@marketer"
    context_requirements:
      - "brand_voice"
      - "target_audience"

# ============================================================================
# SESSION CONTEXT - Accumulated decisions and learnings
# ============================================================================
session_context:
  decisions:
    - decision: "Use Stripe Connect Standard accounts"
      rationale: "Simpler setup, users manage their own Stripe dashboard"
      date: "2025-01-18"
      impact: "Reduced implementation time by ~4 hours"
    - decision: "Use Supabase instead of custom auth"
      rationale: "Free tier sufficient, built-in RLS for security"
      date: "2025-01-15"
    - decision: "Defer custom charts, use Recharts"
      rationale: "Ship faster, can customize later"
      date: "2025-01-20"

  blockers_resolved:
    - blocker: "Stripe webhook signature verification failing"
      resolution: "Raw body needed - used webhook-parser middleware"
      date: "2025-01-21"

  patterns_identified:
    - "Server Actions work well for Stripe API calls"
    - "Edge functions have 10s timeout - use serverless for webhooks"

# ============================================================================
# CHANGELOG - Plan modification history
# ============================================================================
changelog:
  - date: "2025-01-22"
    change: "Updated task 2.2 to in_progress"
    author: "@coordinator"
  - date: "2025-01-21"
    change: "Resolved webhook signature blocker"
    author: "@developer"
  - date: "2025-01-18"
    change: "Made Stripe Connect architecture decision"
    author: "@architect"
  - date: "2025-01-15"
    change: "Initial plan created from ideation.md"
    author: "@strategist"
