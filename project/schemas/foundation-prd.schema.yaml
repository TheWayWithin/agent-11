# PRD (Product Requirements Document) Extraction Schema
# Purpose: Structured data for agents to implement features correctly
# Usage: /foundations init extracts source docs to this format
# Mode: COMPLETENESS MODE - extract 100% of all data

$schema: "http://json-schema.org/draft-07/schema#"
type: object
description: "Structured product requirements for agent consumption"

required:
  - product
  - problem
  - users
  - features

properties:
  product:
    type: object
    required: [name, tagline, type]
    properties:
      name:
        type: string
        description: "Product name"
      tagline:
        type: string
        description: "One-line description"
      type:
        type: string
        description: "Product type (SaaS, API, Mobile, etc.)"
      website:
        type: string
        description: "Domain or URL"
      version:
        type: string
        description: "Current version if applicable"

  problem:
    type: object
    required: [core]
    properties:
      core:
        type: string
        description: "The core problem being solved"
      symptoms:
        type: array
        items:
          type: string
        description: "Observable symptoms of the problem"
      cycle:
        type: array
        items:
          type: string
        description: "The negative cycle users experience"
      cost:
        type: string
        description: "What the problem costs users (time, money, frustration)"

  users:
    type: array
    items:
      type: object
      required: [profile, priority]
      properties:
        profile:
          type: string
          description: "User profile name"
        priority:
          type: integer
          description: "1=primary, 2=secondary, etc."
        products:
          type: string
          description: "Number of products they manage"
        mrr_range:
          type: string
          description: "Typical MRR range"
        pain_points:
          type: array
          items:
            type: string
        success_looks_like:
          type: string

  features:
    type: object
    properties:
      p0_must_have:
        type: array
        description: "Launch blockers - MVP requirements"
        items:
          type: object
          required: [name]
          properties:
            name:
              type: string
            description:
              type: string
            sub_features:
              type: array
              description: "CRITICAL: Extract ALL comma-separated components"
              items:
                type: string
            acceptance_criteria:
              type: array
              items:
                type: string
            success_metric:
              type: string
            dependencies:
              type: array
              items:
                type: string
      p1_should_have:
        type: array
        description: "Important but not launch blocking"
        items:
          $ref: "#/properties/features/properties/p0_must_have/items"
      p2_nice_to_have:
        type: array
        description: "Future enhancements"
        items:
          $ref: "#/properties/features/properties/p0_must_have/items"

  phases:
    type: array
    description: "Development phases with timelines and deliverables"
    items:
      type: object
      required: [name, timeline, deliverables]
      properties:
        name:
          type: string
          description: "Phase name (e.g., 'MVP Foundation')"
        number:
          type: integer
          description: "Phase number (1, 2, 3, etc.)"
        timeline:
          type: object
          required: [start, end]
          properties:
            start:
              type: string
              description: "Start week/date (e.g., 'Week 1')"
            end:
              type: string
              description: "End week/date (e.g., 'Week 6')"
            duration:
              type: string
              description: "Duration (e.g., '6 weeks')"
        deliverables:
          type: array
          description: "ALL deliverables - NEVER truncate this list"
          items:
            type: string
        deliverables_list:
          type: array
          description: "ENHANCED: Structured deliverables with acceptance criteria"
          items:
            type: object
            required: [item, type, acceptance]
            properties:
              item:
                type: string
                description: "Deliverable name (e.g., 'User authentication system')"
              type:
                type: string
                enum: ["code", "database", "integration", "infrastructure", "design", "documentation", "test"]
                description: "Deliverable category"
              acceptance:
                type: string
                description: "How we know it's done (e.g., 'User can sign up/login')"
              dependencies:
                type: array
                items:
                  type: string
                description: "Other deliverables this depends on"
        milestone:
          type: string
          description: "Key milestone at phase end"

  tech_stack:
    type: object
    description: "Technology choices with versions and features"
    properties:
      frontend:
        type: object
        properties:
          name:
            type: string
          version:
            type: string
          features:
            type: array
            items:
              type: string
      backend:
        type: object
        properties:
          name:
            type: string
          version:
            type: string
          features:
            type: array
            items:
              type: string
      database:
        type: object
        properties:
          name:
            type: string
          features:
            type: array
            items:
              type: string
            description: "e.g., ['RLS', 'Edge Functions']"
      auth:
        type: string
      hosting:
        type: object
        properties:
          frontend:
            type: string
          backend:
            type: string
      email:
        type: string
      payments:
        type: string
      ai_models:
        type: array
        description: "ALL supported AI models with providers"
        items:
          type: object
          properties:
            name:
              type: string
              description: "Model name (e.g., 'GPT-4', 'GPT-4o', 'Claude')"
            provider:
              type: string
              description: "Provider (e.g., 'OpenAI', 'Anthropic')"
      queues:
        type: string
      analytics:
        type: string

  success_metrics:
    type: array
    description: "ALL metrics with numeric targets - NEVER omit values"
    items:
      type: object
      required: [metric, target]
      properties:
        metric:
          type: string
        target:
          oneOf:
            - type: number
            - type: string
          description: "Numeric target value (1000, not 'many')"
        unit:
          type: string
          description: "Unit (users, USD, percent, etc.)"
        timeframe:
          type: string
          description: "When to achieve (e.g., '3 months')"
        source_quote:
          type: string
          description: "Original text from source document"

  non_functional_requirements:
    type: object
    description: "Performance, security, and scalability requirements"
    properties:
      performance:
        type: array
        description: "ALL performance SLAs with numeric values"
        items:
          type: object
          properties:
            requirement:
              type: string
            target:
              type: string
              description: "Exact value (e.g., '99.9%', '<5s', '10K')"
            unit:
              type: string
      security:
        type: array
        description: "ALL security requirements"
        items:
          type: string
      scalability:
        type: array
        description: "ALL scalability requirements"
        items:
          type: string
      compliance:
        type: array
        items:
          type: string

  constraints:
    type: object
    properties:
      technical:
        type: array
        items:
          type: string
      business:
        type: array
        items:
          type: string
      timeline:
        type: string
      budget:
        type: string

  pricing:
    type: object
    properties:
      model:
        type: string
        description: "Pricing model (subscription, usage, freemium)"
      tiers:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
            price:
              type: object
              properties:
                amount:
                  type: number
                period:
                  type: string
                currency:
                  type: string
            features:
              type: array
              items:
                type: string
            limits:
              type: object
